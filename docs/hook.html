---

title: Hook

keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "nbs\hook.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\hook.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\bomco\miniconda3\envs\devtorch\lib\site-packages\pytorch_lightning\utilities\distributed.py:37: UserWarning: Unsupported `ReduceOp` for distributed computing.
  warnings.warn(*args, **kwargs)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Hook" class="doc_header"><code>class</code> <code>Hook</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Hook</code>(<strong><code>m</code></strong>, <strong><code>hook_func</code></strong>, <strong><code>is_forward</code></strong>=<em><code>True</code></em>, <strong><code>detach</code></strong>=<em><code>True</code></em>, <strong><code>cpu</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Hooks" class="doc_header"><code>class</code> <code>Hooks</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L44" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Hooks</code>(<strong><code>ms</code></strong>, <strong><code>hook_func</code></strong>, <strong><code>is_forward</code></strong>=<em><code>True</code></em>, <strong><code>detach</code></strong>=<em><code>True</code></em>, <strong><code>cpu</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hook_output" class="doc_header"><code>hook_output</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hook_output</code>(<strong><code>module</code></strong>, <strong><code>detach</code></strong>=<em><code>True</code></em>, <strong><code>cpu</code></strong>=<em><code>False</code></em>, <strong><code>grad</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return a <a href="/isic/hook#Hook"><code>Hook</code></a> that stores outputs of <code>module</code> in <code>self.stored</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hook_outputs" class="doc_header"><code>hook_outputs</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L71" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hook_outputs</code>(<strong><code>modules</code></strong>, <strong><code>detach</code></strong>=<em><code>True</code></em>, <strong><code>cpu</code></strong>=<em><code>False</code></em>, <strong><code>grad</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return <a href="/isic/hook#Hooks"><code>Hooks</code></a> that store outputs of all <code>modules</code> in <code>self.stored</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="dummy_eval" class="doc_header"><code>dummy_eval</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>dummy_eval</code>(<strong><code>m</code></strong>, <strong><code>size</code></strong>=<em><code>(64, 64)</code></em>)</p>
</blockquote>
<p>Evaluate <code>m</code> on a dummy input of a certain <code>size</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="model_sizes" class="doc_header"><code>model_sizes</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>model_sizes</code>(<strong><code>m</code></strong>, <strong><code>size</code></strong>=<em><code>(64, 64)</code></em>)</p>
</blockquote>
<p>Pass a dummy input through the model <code>m</code> to get the output size of each layers.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="num_features_model" class="doc_header"><code>num_features_model</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>num_features_model</code>(<strong><code>m</code></strong>)</p>
</blockquote>
<p>Return the number of output features for <code>m</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="layer_info" class="doc_header"><code>layer_info</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L102" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>layer_info</code>(<strong><code>model</code></strong>, <strong><code>xb</code></strong>)</p>
</blockquote>
<p>Return layer infos of <a href="/isic/model"><code>model</code></a> on <code>xb</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="module_summary" class="doc_header"><code>module_summary</code><a href="https://github.com/termanteus/isic/tree/master/isic/hook.py#L117" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>module_summary</code>(<strong><code>model</code></strong>, <strong><code>bs</code></strong>=<em><code>64</code></em>, <strong><code>size</code></strong>=<em><code>(3, 64, 64)</code></em>)</p>
</blockquote>
<p>Print a summary (input/output of each layer, #params, trainabled) of <a href="/isic/model"><code>model</code></a> depends on the <code>size</code> of a batch</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">bd</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">create_body</span><span class="p">(</span><span class="s1">&#39;resnet18&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_sizes</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[torch.Size([1, 64, 32, 32]),
 torch.Size([1, 64, 32, 32]),
 torch.Size([1, 64, 32, 32]),
 torch.Size([1, 64, 16, 16]),
 torch.Size([1, 64, 16, 16]),
 torch.Size([1, 128, 8, 8]),
 torch.Size([1, 256, 4, 4]),
 torch.Size([1, 512, 2, 2])]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_features_model</span><span class="p">(</span><span class="n">bd</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>512</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xb</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="mi">224</span><span class="p">)</span>
<span class="n">li</span> <span class="o">=</span> <span class="n">layer_info</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span> <span class="n">xb</span><span class="p">)</span>
<span class="n">li</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[(&#39;Conv2d&#39;, 9408, True, torch.Size([1, 64, 112, 112])),
 (&#39;BatchNorm2d&#39;, 128, True, torch.Size([1, 64, 112, 112])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 64, 112, 112])),
 (&#39;MaxPool2d&#39;, 0, False, torch.Size([1, 64, 56, 56])),
 (&#39;Conv2d&#39;, 36864, True, torch.Size([1, 64, 56, 56])),
 (&#39;BatchNorm2d&#39;, 128, True, torch.Size([1, 64, 56, 56])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 64, 56, 56])),
 (&#39;Conv2d&#39;, 36864, True, torch.Size([1, 64, 56, 56])),
 (&#39;BatchNorm2d&#39;, 128, True, torch.Size([1, 64, 56, 56])),
 (&#39;Conv2d&#39;, 36864, True, torch.Size([1, 64, 56, 56])),
 (&#39;BatchNorm2d&#39;, 128, True, torch.Size([1, 64, 56, 56])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 64, 56, 56])),
 (&#39;Conv2d&#39;, 36864, True, torch.Size([1, 64, 56, 56])),
 (&#39;BatchNorm2d&#39;, 128, True, torch.Size([1, 64, 56, 56])),
 (&#39;Conv2d&#39;, 73728, True, torch.Size([1, 128, 28, 28])),
 (&#39;BatchNorm2d&#39;, 256, True, torch.Size([1, 128, 28, 28])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 128, 28, 28])),
 (&#39;Conv2d&#39;, 147456, True, torch.Size([1, 128, 28, 28])),
 (&#39;BatchNorm2d&#39;, 256, True, torch.Size([1, 128, 28, 28])),
 (&#39;Conv2d&#39;, 8192, True, torch.Size([1, 128, 28, 28])),
 (&#39;BatchNorm2d&#39;, 256, True, torch.Size([1, 128, 28, 28])),
 (&#39;Conv2d&#39;, 147456, True, torch.Size([1, 128, 28, 28])),
 (&#39;BatchNorm2d&#39;, 256, True, torch.Size([1, 128, 28, 28])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 128, 28, 28])),
 (&#39;Conv2d&#39;, 147456, True, torch.Size([1, 128, 28, 28])),
 (&#39;BatchNorm2d&#39;, 256, True, torch.Size([1, 128, 28, 28])),
 (&#39;Conv2d&#39;, 294912, True, torch.Size([1, 256, 14, 14])),
 (&#39;BatchNorm2d&#39;, 512, True, torch.Size([1, 256, 14, 14])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 256, 14, 14])),
 (&#39;Conv2d&#39;, 589824, True, torch.Size([1, 256, 14, 14])),
 (&#39;BatchNorm2d&#39;, 512, True, torch.Size([1, 256, 14, 14])),
 (&#39;Conv2d&#39;, 32768, True, torch.Size([1, 256, 14, 14])),
 (&#39;BatchNorm2d&#39;, 512, True, torch.Size([1, 256, 14, 14])),
 (&#39;Conv2d&#39;, 589824, True, torch.Size([1, 256, 14, 14])),
 (&#39;BatchNorm2d&#39;, 512, True, torch.Size([1, 256, 14, 14])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 256, 14, 14])),
 (&#39;Conv2d&#39;, 589824, True, torch.Size([1, 256, 14, 14])),
 (&#39;BatchNorm2d&#39;, 512, True, torch.Size([1, 256, 14, 14])),
 (&#39;Conv2d&#39;, 1179648, True, torch.Size([1, 512, 7, 7])),
 (&#39;BatchNorm2d&#39;, 1024, True, torch.Size([1, 512, 7, 7])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 512, 7, 7])),
 (&#39;Conv2d&#39;, 2359296, True, torch.Size([1, 512, 7, 7])),
 (&#39;BatchNorm2d&#39;, 1024, True, torch.Size([1, 512, 7, 7])),
 (&#39;Conv2d&#39;, 131072, True, torch.Size([1, 512, 7, 7])),
 (&#39;BatchNorm2d&#39;, 1024, True, torch.Size([1, 512, 7, 7])),
 (&#39;Conv2d&#39;, 2359296, True, torch.Size([1, 512, 7, 7])),
 (&#39;BatchNorm2d&#39;, 1024, True, torch.Size([1, 512, 7, 7])),
 (&#39;ReLU&#39;, 0, False, torch.Size([1, 512, 7, 7])),
 (&#39;Conv2d&#39;, 2359296, True, torch.Size([1, 512, 7, 7])),
 (&#39;BatchNorm2d&#39;, 1024, True, torch.Size([1, 512, 7, 7]))]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_print_shapes</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="mi">64</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;64 x 64 x 112 x 112&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">module_summary</span><span class="p">(</span><span class="n">bd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Sequential (Input shape: 64 x 3 x 224 x 224)
================================================================
Layer (type)         Output Shape         Param #    Trainable 
================================================================
Conv2d               64 x 64 x 112 x 112  9,408      True      
________________________________________________________________
BatchNorm2d          64 x 64 x 112 x 112  128        True      
________________________________________________________________
ReLU                 64 x 64 x 112 x 112  0          False     
________________________________________________________________
MaxPool2d            64 x 64 x 56 x 56    0          False     
________________________________________________________________
Conv2d               64 x 64 x 56 x 56    36,864     True      
________________________________________________________________
BatchNorm2d          64 x 64 x 56 x 56    128        True      
________________________________________________________________
ReLU                 64 x 64 x 56 x 56    0          False     
________________________________________________________________
Conv2d               64 x 64 x 56 x 56    36,864     True      
________________________________________________________________
BatchNorm2d          64 x 64 x 56 x 56    128        True      
________________________________________________________________
Conv2d               64 x 64 x 56 x 56    36,864     True      
________________________________________________________________
BatchNorm2d          64 x 64 x 56 x 56    128        True      
________________________________________________________________
ReLU                 64 x 64 x 56 x 56    0          False     
________________________________________________________________
Conv2d               64 x 64 x 56 x 56    36,864     True      
________________________________________________________________
BatchNorm2d          64 x 64 x 56 x 56    128        True      
________________________________________________________________
Conv2d               64 x 128 x 28 x 28   73,728     True      
________________________________________________________________
BatchNorm2d          64 x 128 x 28 x 28   256        True      
________________________________________________________________
ReLU                 64 x 128 x 28 x 28   0          False     
________________________________________________________________
Conv2d               64 x 128 x 28 x 28   147,456    True      
________________________________________________________________
BatchNorm2d          64 x 128 x 28 x 28   256        True      
________________________________________________________________
Conv2d               64 x 128 x 28 x 28   8,192      True      
________________________________________________________________
BatchNorm2d          64 x 128 x 28 x 28   256        True      
________________________________________________________________
Conv2d               64 x 128 x 28 x 28   147,456    True      
________________________________________________________________
BatchNorm2d          64 x 128 x 28 x 28   256        True      
________________________________________________________________
ReLU                 64 x 128 x 28 x 28   0          False     
________________________________________________________________
Conv2d               64 x 128 x 28 x 28   147,456    True      
________________________________________________________________
BatchNorm2d          64 x 128 x 28 x 28   256        True      
________________________________________________________________
Conv2d               64 x 256 x 14 x 14   294,912    True      
________________________________________________________________
BatchNorm2d          64 x 256 x 14 x 14   512        True      
________________________________________________________________
ReLU                 64 x 256 x 14 x 14   0          False     
________________________________________________________________
Conv2d               64 x 256 x 14 x 14   589,824    True      
________________________________________________________________
BatchNorm2d          64 x 256 x 14 x 14   512        True      
________________________________________________________________
Conv2d               64 x 256 x 14 x 14   32,768     True      
________________________________________________________________
BatchNorm2d          64 x 256 x 14 x 14   512        True      
________________________________________________________________
Conv2d               64 x 256 x 14 x 14   589,824    True      
________________________________________________________________
BatchNorm2d          64 x 256 x 14 x 14   512        True      
________________________________________________________________
ReLU                 64 x 256 x 14 x 14   0          False     
________________________________________________________________
Conv2d               64 x 256 x 14 x 14   589,824    True      
________________________________________________________________
BatchNorm2d          64 x 256 x 14 x 14   512        True      
________________________________________________________________
Conv2d               64 x 512 x 7 x 7     1,179,648  True      
________________________________________________________________
BatchNorm2d          64 x 512 x 7 x 7     1,024      True      
________________________________________________________________
ReLU                 64 x 512 x 7 x 7     0          False     
________________________________________________________________
Conv2d               64 x 512 x 7 x 7     2,359,296  True      
________________________________________________________________
BatchNorm2d          64 x 512 x 7 x 7     1,024      True      
________________________________________________________________
Conv2d               64 x 512 x 7 x 7     131,072    True      
________________________________________________________________
BatchNorm2d          64 x 512 x 7 x 7     1,024      True      
________________________________________________________________
Conv2d               64 x 512 x 7 x 7     2,359,296  True      
________________________________________________________________
BatchNorm2d          64 x 512 x 7 x 7     1,024      True      
________________________________________________________________
ReLU                 64 x 512 x 7 x 7     0          False     
________________________________________________________________
Conv2d               64 x 512 x 7 x 7     2,359,296  True      
________________________________________________________________
BatchNorm2d          64 x 512 x 7 x 7     1,024      True      
________________________________________________________________

Total params: 11,176,512
Total trainable params: 11,176,512
Total non-trainable params: 0
</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

